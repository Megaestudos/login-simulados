<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Simulados de Concursos</title>

<style>
:root{
--primary:#2563eb;
--primary-dark:#1e40af;
--card:#ffffff;
--text:#0f172a;
--border:#e2e8f0;
}
*{box-sizing:border-box}
body{
margin:0;
font-family:Inter,system-ui,Arial,sans-serif;
min-height:100vh;
background:linear-gradient(rgba(15,23,42,.7),rgba(15,23,42,.7)),
url("https://images.pexels.com/photos/990432/pexels-photo-990432.jpeg");
background-size:cover;
background-position:center;
color:#fff;
}
.page{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
.container{width:100%;max-width:980px;display:grid;grid-template-columns:1.2fr 1fr;gap:40px}
@media(max-width:900px){.container{grid-template-columns:1fr}}
.card{
background:#fff;color:#0f172a;border-radius:20px;
padding:32px;box-shadow:0 40px 80px rgba(0,0,0,.35)
}
input,button{width:100%;padding:14px;border-radius:12px;font-size:15px}
input{border:1px solid var(--border);margin:6px 0 16px}
button{border:0;cursor:pointer}
.btn-primary{background:var(--primary);color:#fff}
.btn-sec{background:#f1f5f9;margin-top:10px}
.hide{display:none}
.msg{margin-top:14px;font-size:14px;color:#dc2626;text-align:center}
.hr{height:1px;background:#e2e8f0;margin:18px 0}
.plan{border:1px solid #e2e8f0;border-radius:14px;padding:14px;margin-top:10px}
.qrImg{width:100%;max-width:260px}
</style>
</head>

<body>
<div class="page">
<div class="container">

<div>
<h1>Prepare-se para concursos</h1>
<p>Teste gr√°tis por 48 horas</p>
</div>

<div class="card">

<div id="loginBox">
<input id="email" type="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button class="btn-primary" id="btnEntrar">Entrar</button>
<button class="btn-sec" id="btnCriar">Criar conta gratuita</button>
<div id="msgLogin" class="msg"></div>
</div>

<div id="payBox" class="hide">
<div class="hr"></div>
<div id="payMsg"></div>

<div class="plan">
<strong>Plano 6 meses</strong>
<button class="btn-primary" id="btnPlano6">Gerar PIX</button>
</div>

<div id="qrBox" class="hide">
<img id="qrImg" class="qrImg">
<input id="pixCopia" readonly>
<button id="btnCopiar">Copiar</button>
</div>
</div>

</div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import {
getAuth,signInWithEmailAndPassword,
createUserWithEmailAndPassword,
sendEmailVerification,signOut,
setPersistence,browserSessionPersistence
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFunctions, httpsCallable }
from "https://www.gstatic.com/firebasejs/10.12.5/firebase-functions.js";

const firebaseConfig={
apiKey:"AIzaSyB36ZszS8v_DeOn3at7zEo_tFq86WU0sI4",
authDomain:"simulados-concursos-22c91.firebaseapp.com",
projectId:"simulados-concursos-22c91"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
await setPersistence(auth,browserSessionPersistence);
const functions=getFunctions(app,"us-central1");

const me= httpsCallable(functions,"me");
const createPix= httpsCallable(functions,"createPixCharge");
const pixStatus= httpsCallable(functions,"pixStatus");

const $=id=>document.getElementById(id);

$("btnEntrar").onclick=entrar;
$("btnCriar").onclick=criarConta;
$("btnPlano6").onclick=()=>gerarPix("6m");
$("btnCopiar").onclick=()=>navigator.clipboard.writeText($("pixCopia").value);

async function entrar(){
try{
const email=$("email").value.trim();
const senha=$("senha").value;
if(!email||!senha) return msg("Preencha tudo");

await signInWithEmailAndPassword(auth,email,senha);
const res=await me();

if(!res.data.emailVerified)
return msg("Confirme seu e-mail");

if(!res.data.entitled){
$("loginBox").classList.add("hide");
$("payBox").classList.remove("hide");
$("payMsg").innerText="Seu acesso expirou";
return;
}

location.href="https://megaestudos.github.io/Quiz-Guarda-Civil-Premium/";

}catch{msg("Erro ao entrar")}
}

async function criarConta(){
try{
const email=$("email").value.trim();
const senha=$("senha").value;
if(!email||!senha) return msg("Preencha tudo");

const cred=await createUserWithEmailAndPassword(auth,email,senha);
await sendEmailVerification(cred.user);
await signOut(auth);
msg("Confirme seu e-mail antes de entrar");

}catch{msg("Erro ao criar conta")}
}

let timer=null;
async function gerarPix(plan){
const res=await createPix({plan});
$("qrBox").classList.remove("hide");
$("qrImg").src="data:image/png;base64,"+res.data.qrcodeImage;
$("pixCopia").value=res.data.copiaecola;
timer=setInterval(()=>checar(res.data.txid),5000);
}

async function checar(txid){
const res=await pixStatus({txid});
if(res.data.paid){
clearInterval(timer);
location.href="https://megaestudos.github.io/Quiz-Guarda-Civil-Premium/";
}
}

function msg(t){$("msgLogin").innerText=t}
</script>
</body>
</html>
