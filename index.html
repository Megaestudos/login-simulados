<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Simulados de Concursos - DEBUG</title>

<style>
:root{
--primary:#2563eb;
--primary-dark:#1e40af;
--card:#ffffff;
--text:#0f172a;
--muted:#cbd5f5;
--border:#e2e8f0;
--success:#16a34a;
--danger:#dc2626;
}
*{box-sizing:border-box}
body{
margin:0;
font-family: Inter, system-ui, -apple-system, Arial, sans-serif;
min-height:100vh;
color:#fff;
background:
linear-gradient(rgba(15,23,42,0.70), rgba(15,23,42,0.70)),
url("https://images.pexels.com/photos/990432/pexels-photo-990432.jpeg");
background-size:cover;
background-position:center;
background-attachment:fixed;
}
.page{
min-height:100vh;
display:flex;
align-items:center;
justify-content:center;
padding:24px;
}
.container{
width:100%;
max-width:980px;
display:grid;
grid-template-columns:1.2fr 1fr;
gap:40px;
}
@media(max-width:900px){
.container{grid-template-columns:1fr}
}
.hero h1{font-size:38px;margin:0 0 12px}
.hero p{font-size:18px;color:#e5e7eb}
.hero ul{list-style:none;padding:0}
.hero li{margin:10px 0}
.hero li::before{content:"‚úì ";color:#22c55e}

.card{
background:var(--card);
color:var(--text);
border-radius:20px;
padding:32px;
box-shadow:0 40px 80px rgba(0,0,0,.35);
}
label{font-size:14px;color:#475569}
input{
width:100%;
padding:14px;
margin:6px 0 16px;
border-radius:12px;
border:1px solid var(--border);
font-size:15px;
}
button{
width:100%;
padding:14px;
border-radius:12px;
border:0;
font-size:15px;
cursor:pointer;
}
.btn-primary{background:var(--primary);color:#fff}
.btn-primary:hover{background:var(--primary-dark)}
.btn-sec{background:#f1f5f9;margin-top:10px}
.btn-sec:hover{background:#e2e8f0}
.msg{margin-top:14px;font-size:14px;text-align:center;color:var(--danger)}
.debug-panel{
background:#1e293b;
border:2px solid #f59e0b;
border-radius:12px;
padding:16px;
margin-bottom:16px;
font-family:monospace;
font-size:12px;
color:#f59e0b;
}
.debug-panel.error{
background:#450a0a;
border-color:#dc2626;
color:#fca5a5;
}
.debug-panel.success{
background:#064e3b;
border-color:#10b981;
color:#6ee7b7;
}
.hide{display:none !important}

.hr{height:1px;background:#e2e8f0;margin:18px 0}
.small{font-size:13px;color:#64748b;line-height:1.35}
</style>
</head>

<body>
<div class="page">
<div class="container">

<!-- HERO -->
<div class="hero">
<h1>Prepare-se para concursos<br>com foco total em aprova√ß√£o</h1>
<p>Simulados atualizados, estudo direto ao ponto e acesso imediato.</p>
<ul>
<li>Quest√µes comentadas</li>
<li>Simulados realistas</li>
<li>Conte√∫do focado em prova</li>
<li>Teste gratuito por 48 horas</li>
</ul>
</div>

<!-- CARD -->
<div class="card">
<h2>Acesso √† plataforma</h2>
<p class="small">Entre com sua conta.</p>

<!-- PAINEL DE DEBUG -->
<div id="debugPanel" class="debug-panel hide">
<div id="debugContent"></div>
</div>

<!-- LOGIN FORM -->
<div id="loginBox">
<label>Email</label>
<input id="email" type="email" placeholder="seu@email.com">

<label>Senha</label>
<div style="position:relative">
<input
id="senha"
type="password"
placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
style="padding-right:44px"
>
<span
id="toggleSenha"
style="
   position:absolute;
   right:14px;
   top:50%;
   transform:translateY(-50%);
   cursor:pointer;
   font-size:18px;
   opacity:.6;
 "
title="Mostrar senha"
>üëÅÔ∏è</span>
</div>

<button class="btn-primary" id="btnEntrar">Entrar</button>
<button class="btn-sec" id="btnCriar">Criar conta gratuita</button>

<div id="msgLogin" class="msg"></div>
</div>

<!-- STATUS -->
<div id="statusBox" class="hide">
<div class="hr"></div>
<div id="statusText" style="font-weight:900;font-size:18px;margin-bottom:8px"></div>
<div id="statusSub" class="small" style="margin-bottom:16px"></div>

<button class="btn-primary" id="btnAcessarApp">
üöÄ Acessar o App
</button>

<button class="btn-sec" id="btnSair">
Sair
</button>
</div>

</div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import {
getAuth,
signInWithEmailAndPassword,
createUserWithEmailAndPassword,
signOut,
sendEmailVerification,
onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-functions.js";

/* ===== CONFIG ===== */
const FRONT_URL = "https://megaestudos.github.io/Quiz-Guarda-Civil-Premium/";
const firebaseConfig = {
apiKey: "AIzaSyB36ZszS8v_DeOn3at7zEo_tFq86WU0sI4",
authDomain: "simulados-concursos-22c91.firebaseapp.com",
projectId: "simulados-concursos-22c91"
};

/* ===== INIT ===== */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const fx = getFunctions(app, "us-central1");

const meCall = httpsCallable(fx, "me");

/* ===== UI ===== */
const $ = (id)=>document.getElementById(id);
const show = (boxId)=>{
["loginBox","statusBox"].forEach(x=>$(x).classList.toggle("hide", x!==boxId));
};
function setMsg(t){ $("msgLogin").innerText = t || ""; }

/* ===== DEBUG ===== */
function debug(msg, isError = false) {
const panel = $("debugPanel");
const content = $("debugContent");
panel.classList.remove("hide", "error", "success");
panel.classList.add(isError ? "error" : "success");
content.innerHTML = `<strong>${isError ? "‚ùå ERRO:" : "‚úÖ"}</strong> ${msg}`;
console.log("[DEBUG]", msg);
}

/* ===== EVENTOS ===== */
$("btnEntrar").addEventListener("click", entrar);
$("btnCriar").addEventListener("click", criarConta);
$("btnAcessarApp").addEventListener("click", () => {
window.location.href = FRONT_URL;
});
$("btnSair").addEventListener("click", async () => {
await signOut(auth);
$("email").value = "";
$("senha").value = "";
show("loginBox");
});

// üëÅÔ∏è Mostrar / esconder senha
const toggleSenha = document.getElementById("toggleSenha");
const senhaInput = document.getElementById("senha");
if (toggleSenha && senhaInput) {
toggleSenha.addEventListener("click", () => {
const isPassword = senhaInput.type === "password";
senhaInput.type = isPassword ? "text" : "password";
toggleSenha.innerText = isPassword ? "üôà" : "üëÅÔ∏è";
});
}

/* ===== LOGIN ===== */
async function entrar() {
const email = $("email").value.trim();
const senha = $("senha").value;

if (!email || !senha) {
setMsg("Preencha e-mail e senha.");
return;
}

debug("Tentando fazer login com: " + email);
$("btnEntrar").innerText = "Carregando...";
$("btnEntrar").disabled = true;

try {
debug("Chamando Firebase Auth...");
await signInWithEmailAndPassword(auth, email, senha);
debug("Firebase Auth OK!");

debug("Chamando Cloud Function 'me'...");
const resp = await meCall();
const data = resp.data;

debug("Cloud Function retornou: " + JSON.stringify(data));

if (!data.authenticated) {
debug("Sess√£o inv√°lida", true);
show("loginBox");
setMsg("Sess√£o inv√°lida. Fa√ßa login novamente.");
$("btnEntrar").innerText = "Entrar";
$("btnEntrar").disabled = false;
return;
}

if (data.emailVerified === false) {
debug("E-mail n√£o confirmado", true);
show("statusBox");
$("statusText").innerText = "‚ö†Ô∏è E-mail n√£o confirmado";
$("statusSub").innerText = "Verifique sua caixa de entrada e spam.";
$("btnEntrar").innerText = "Entrar";
$("btnEntrar").disabled = false;
return;
}

const status = data.entitled ? data.plan : "none";
const fim = data.expiresAt ? new Date(data.expiresAt) : null;

show("statusBox");

if (status === "trial") {
$("statusText").innerText = "üïê Teste gr√°tis ativo";
$("statusSub").innerText = fim ? ("V√°lido at√©: " + fim.toLocaleString()) : "";
} else if (status === "premium") {
$("statusText").innerText = "‚úÖ Acesso Premium ativo";
$("statusSub").innerText = fim ? ("V√°lido at√©: " + fim.toLocaleString()) : "";
} else {
$("statusText").innerText = "‚ùå Sem acesso";
$("statusSub").innerText = "Voc√™ precisa fazer o teste ou assinar.";
}

debug("Login OK! Status: " + status);

} catch (e) {
console.error("Erro completo:", e);
debug("ERRO: " + e.message + " (c√≥digo: " + e.code + ")", true);
setMsg(e?.message || "Erro ao fazer login");
} finally {
$("btnEntrar").innerText = "Entrar";
$("btnEntrar").disabled = false;
}
}

/* ===== CRIAR CONTA ===== */
async function criarConta(){
const email = $("email").value.trim();
const senha = $("senha").value;

if(!email || !senha){ setMsg("Preencha email e senha."); return; }

debug("Criando conta: " + email);
$("btnCriar").innerText = "Carregando...";
$("btnCriar").disabled = true;

try{
await createUserWithEmailAndPassword(auth, email, senha);
await sendEmailVerification(auth.currentUser);
debug("Conta criada! Verifique seu e-mail.");
setMsg("Enviamos um e-mail de verifica√ß√£o. Confirme antes de comprar.");
}catch(e){
console.error("Erro criar conta:", e);
debug("ERRO: " + e.message, true);
setMsg(e?.message || "Erro ao criar conta");
} finally {
$("btnCriar").innerText = "Criar conta gratuita";
$("btnCriar").disabled = false;
}
}

/* ===== START ===== */
onAuthStateChanged(auth, (user) => {
if (!user) {
show("loginBox");
return;
}
// Se j√° est√° logado, verificar status
entrar();
});

// estado inicial
show("loginBox");
debug("P√°gina carregada. Ready!");
</script>
</body>
</html>
