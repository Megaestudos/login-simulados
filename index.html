<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Simulados de Concursos</title>

<style>
:root{
--primary:#2563eb;
--primary-dark:#1e40af;
--card:#ffffff;
--text:#0f172a;
--muted:#cbd5f5;
--border:#e2e8f0;
--success:#16a34a;
}
*{box-sizing:border-box}
body{
margin:0;
font-family: Inter, system-ui, -apple-system, Arial, sans-serif;
min-height:100vh;
color:#fff;
background:
linear-gradient(rgba(15,23,42,0.70), rgba(15,23,42,0.70)),
url("https://images.pexels.com/photos/990432/pexels-photo-990432.jpeg");
background-size:cover;
background-position:center;
background-attachment:fixed;
}
.page{
min-height:100vh;
display:flex;
align-items:center;
justify-content:center;
padding:24px;
}
.container{
width:100%;
max-width:980px;
display:grid;
grid-template-columns:1.2fr 1fr;
gap:40px;
}
@media(max-width:900px){
.container{grid-template-columns:1fr}
}
.hero h1{font-size:38px;margin:0 0 12px}
.hero p{font-size:18px;color:#e5e7eb}
.hero ul{list-style:none;padding:0}
.hero li{margin:10px 0}
.hero li::before{content:"‚úì ";color:#22c55e}

.card{
background:var(--card);
color:var(--text);
border-radius:20px;
padding:32px;
box-shadow:0 40px 80px rgba(0,0,0,.35);
}
label{font-size:14px;color:#475569}
input{
width:100%;
padding:14px;
margin:6px 0 16px;
border-radius:12px;
border:1px solid var(--border);
font-size:15px;
}
button{
width:100%;
padding:14px;
border-radius:12px;
border:0;
font-size:15px;
cursor:pointer;
}
.btn-primary{background:var(--primary);color:#fff}
.btn-primary:hover{background:var(--primary-dark)}
.btn-sec{background:#f1f5f9;margin-top:10px}
.msg{margin-top:14px;font-size:14px;text-align:center;color:#dc2626}
.hide{display:none}

.hr{height:1px;background:#e2e8f0;margin:18px 0}
.small{font-size:13px;color:#64748b;line-height:1.35}

.plan-grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
.plan{
border:1px solid #e2e8f0;
border-radius:14px;
padding:14px;
background:#fff;
}
.plan .top{display:flex;justify-content:space-between;align-items:center;gap:10px}
.badge{
background:#e0e7ff;
color:#1e40af;
padding:6px 10px;
border-radius:999px;
font-size:13px;
font-weight:700;
}
.reco{
border:2px solid #2563eb;
box-shadow:0 10px 24px rgba(37,99,235,.15);
}
.price{font-size:22px;font-weight:900;color:#0f172a;margin:8px 0 0}
.plan button{margin-top:10px}

.qrWrap{margin-top:10px}
.qrImg{width:100%;max-width:260px;border:1px solid #e2e8f0;border-radius:12px;padding:10px;background:#fff}
.copyRow{display:flex;gap:8px;margin-top:10px}
.copyRow input{margin:0;flex:1}
.copyRow button{width:auto;padding:12px 14px;border-radius:12px;background:#0f172a;color:#fff}
.ok{color:#16a34a}
/* ===== MODAL ===== */
.modal-overlay{
position:fixed;
inset:0;
background:rgba(15,23,42,0.75);
display:flex;
align-items:center;
justify-content:center;
z-index:9999;
}

.modal-box{
background:#fff;
color:#0f172a;
width:100%;
max-width:420px;
border-radius:20px;
padding:28px;
text-align:center;
box-shadow:0 40px 80px rgba(0,0,0,.4);
animation:pop .2s ease-out;
}

.modal-icon{
font-size:40px;
margin-bottom:10px;
}

.modal-box h3{
margin:0 0 10px;
font-size:22px;
}

.modal-box p{
font-size:15px;
color:#475569;
margin-bottom:18px;
}

@keyframes pop{
from{ transform:scale(.9); opacity:0 }
to{ transform:scale(1); opacity:1 }
}

.hide{ display:none; }
</style>
</head>
<!-- ===== MODAL GLOBAL ===== -->
<div id="modalOverlay" class="modal-overlay hide">
<div class="modal-box">
<div id="modalIcon" class="modal-icon">‚ÑπÔ∏è</div>
<h3 id="modalTitle">T√≠tulo</h3>
<p id="modalMessage">Mensagem</p>
<button id="modalBtn" class="btn-primary">OK</button>
</div>
</div>

<body>
<div class="page">
<div class="container">

<!-- HERO -->
<div class="hero">
<h1>Prepare-se para concursos<br>com foco total em aprova√ß√£o</h1>
<p>Simulados atualizados, estudo direto ao ponto e acesso imediato.</p>
<ul>
<li>Quest√µes comentadas</li>
<li>Simulados realistas</li>
<li>Conte√∫do focado em prova</li>
<li>Teste gratuito por 48 horas</li>
</ul>
</div>

<!-- CARD -->
<div class="card">
<h2>Acesso √† plataforma</h2>
<p class="small">Entre com sua conta. Se estiver no teste, voc√™ ver√° o tempo restante. Se expirou, voc√™ pode assinar.</p>

<!-- LOGIN FORM -->
<div id="loginBox">
<label>Email</label>
<input id="email" type="email" placeholder="seu@email.com">

<label>Senha</label>
<div style="position:relative">
<input
id="senha"
type="password"
placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
style="padding-right:44px"
>
<span
id="toggleSenha"
style="
     position:absolute;
     right:14px;
     top:50%;
     transform:translateY(-50%);
     cursor:pointer;
     font-size:18px;
     opacity:.6;
   "
title="Mostrar senha"
>üëÅÔ∏è</span>
</div>

<button class="btn-primary" id="btnEntrar">Entrar</button>
<button class="btn-sec" id="btnCriar">Criar conta gratuita</button>
<button
class="btn-sec"
id="btnResetSenha"
style="margin-top:6px"
>
Esqueci minha senha
</button>

<div id="msgLogin" class="msg"></div>
</div>

<!-- STATUS -->
<div id="statusBox" class="hide">
<div class="hr"></div>
<div id="statusText" style="font-weight:900"></div>
<div id="statusSub" class="small" style="margin-top:6px"></div>

<button class="btn-primary" id="btnAcessarApp">
Acessar o App
</button>

<button class="btn-sec" id="btnSair">
Sair
</button>
</div>

<!-- PAYWALL -->
<div id="payBox" class="hide">
<div class="hr"></div>
<div style="font-weight:900">Seu acesso expirou</div>
<div class="small" style="margin-top:6px">Escolha um plano. O de 6 meses fica em destaque (recomendado).</div>

<div class="plan-grid">
<div class="plan reco">
<div class="top">
<div style="font-weight:900">Plano 6 meses</div>
<span class="badge">Recomendado</span>
</div>
<div class="price">R$ 29,90</div>
<div class="small">Acesso completo por 6 meses (ideal para come√ßar).</div>
<button class="btn-primary" id="btnPlano6">Gerar PIX (6 meses)</button>
</div>

<div class="plan">
<div class="top">
<div style="font-weight:900">Plano 1 ano</div>
<span class="badge">Economia</span>
</div>
<div class="price">R$ 49,90</div>
<div class="small">Acesso completo por 12 meses (melhor custo-benef√≠cio).</div>
<button class="btn-primary" id="btnPlano12">Gerar PIX (1 ano)</button>
</div>
</div>

<!-- QR -->
<div id="qrBox" class="qrWrap hide">
<div class="hr"></div>
<div style="font-weight:900">Pague com PIX</div>
<div class="small" id="qrSub" style="margin-top:6px"></div>

<img id="qrImg" class="qrImg" alt="QR Code PIX">

<div class="copyRow">
<input id="pixCopia" readonly>
<button id="btnCopiar">Copiar</button>
</div>

<div id="payMsg" class="small" style="margin-top:10px"></div>
</div>

</div>
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import {
getAuth,
setPersistence,
browserSessionPersistence,
signInWithEmailAndPassword,
createUserWithEmailAndPassword,
signOut,
sendEmailVerification
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-functions.js";
import { sendPasswordResetEmail } from
"https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { onAuthStateChanged } from
"https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";


/* ===== CONFIG ===== */
const FRONT_URL = "https://megaestudos.github.io/Quiz-Guarda-Civil-Premium/";
const firebaseConfig = {
apiKey: "AIzaSyB36ZszS8v_DeOn3at7zEo_tFq86WU0sI4",
authDomain: "simulados-concursos-22c91.firebaseapp.com",
projectId: "simulados-concursos-22c91"
};

/* ===== INIT ===== */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// Persist√™ncia (UMA VEZ)
try {
await setPersistence(auth, browserSessionPersistence);
} catch (err) {
console.error("Erro setPersistence:", err);
}

const functionsRegion = "us-central1";
const fx = getFunctions(app, functionsRegion); // N√ÉO chame isso de "functions" em outros lugares

const meCall = httpsCallable(fx, "me");
const createPixChargeCall = httpsCallable(fx, "createPixCharge");
const pixStatusCall = httpsCallable(fx, "pixStatus");

/* ===== UI ===== */
const $ = (id)=>document.getElementById(id);
const show = (boxId)=>{
["loginBox","statusBox","payBox"].forEach(x=>$(x).classList.toggle("hide", x!==boxId));
};
function setMsg(t){ $("msgLogin").innerText = t || ""; }

  /* ===== MODAL ===== */
function abrirModal(tipo, titulo, mensagem) {
  const overlay = $("modalOverlay");
  const icon = $("modalIcon");
  const title = $("modalTitle");
  const msg = $("modalMessage");

  // √≠cones por tipo
  const icons = {
    sucesso: "‚úÖ",
    erro: "‚ùå",
    aviso: "‚ö†Ô∏è",
    info: "‚ÑπÔ∏è"
  };

  icon.innerText = icons[tipo] || "‚ÑπÔ∏è";
  title.innerText = titulo || "Aviso";
  msg.innerText = mensagem || "";

  overlay.classList.remove("hide");
}

function fecharModal() {
  $("modalOverlay").classList.add("hide");
}

// Fecha no bot√£o OK
$("modalBtn").addEventListener("click", fecharModal);

// Fecha clicando fora da caixa
$("modalOverlay").addEventListener("click", (e) => {
  if (e.target.id === "modalOverlay") fecharModal();
});


/* ===== EVENTS ===== */
$("btnEntrar").addEventListener("click", entrar);
$("btnCriar").addEventListener("click", criarConta);
// üëÅÔ∏è Mostrar / esconder senha
const toggleSenha = document.getElementById("toggleSenha");
const senhaInput = document.getElementById("senha");

if (toggleSenha && senhaInput) {
toggleSenha.addEventListener("click", () => {
const isPassword = senhaInput.type === "password";
senhaInput.type = isPassword ? "text" : "password";
toggleSenha.innerText = isPassword ? "üôà" : "üëÅÔ∏è";
});
}
document
.getElementById("btnResetSenha")
.addEventListener("click", recuperarSenha);

$("btnSair").addEventListener("click", async () => {
  try {
    await signOut(auth);
  } catch (e) {
    console.warn("Erro ao sair:", e);
  }

  // limpa campos
  $("email").value = "";
  $("senha").value = "";

  // limpa mensagens
  setMsg("");
  $("payMsg").innerText = "";
  $("qrSub").innerText = "";
  $("qrBox").classList.add("hide");

  // cancela polling se existir
  if (pollingTimer) {
    clearInterval(pollingTimer);
    pollingTimer = null;
  }

  // volta para login
  show("loginBox");
});

/* ===== LOGIN ===== */
async function entrar() {
try {
setMsg("");
const email = $("email").value.trim();
const senha = $("senha").value;

if (!email || !senha) {
setMsg("Preencha e-mail e senha.");
return;
}

await signInWithEmailAndPassword(auth, email, senha);
await carregarStatus();
} catch (e) {
console.error("Erro ao entrar:", e);
abrirModal(
"erro",
"Erro ao entrar",
"E-mail ou senha inv√°lidos. Verifique os dados e tente novamente."
);

}
}

async function criarConta(){
try{
setMsg("");
const email = $("email").value.trim();
const senha = $("senha").value;
if(!email || !senha){ setMsg("Preencha email e senha."); return; }

await createUserWithEmailAndPassword(auth, email, senha);

// üîê ENVIA E-MAIL DE VERIFICA√á√ÉO
await sendEmailVerification(auth.currentUser);

// ‚ö†Ô∏è AVISA O USU√ÅRIO
setMsg("Enviamos um e-mail de verifica√ß√£o. Confirme antes de comprar.");

// N√ÉO chama carregarStatus ainda
return;

}catch(e){
console.error("Erro criar conta:", e);
setMsg(e?.message || "Erro ao criar conta");
}
}

/* ===== STATUS ===== */
async function carregarStatus(){
const user = auth.currentUser;
if(!user){ show("loginBox"); return; }

let data;
try {
const resp = await meCall();
data = resp.data;
} catch (e) {
console.error("Erro meCall:", e);
show("loginBox");
setMsg(e?.message || "Falha ao validar sess√£o. Fa√ßa login novamente.");
return;
}

if(!data.authenticated){
show("loginBox");
setMsg("Sess√£o inv√°lida. Fa√ßa login novamente.");
return;
}

const status = data.entitled ? data.plan : "none";
const expiresIso = data.expiresAt || null;
const fim = expiresIso ? new Date(expiresIso) : null;

if (status === "trial" || status === "premium") {
  fecharModal(); // ‚Üê FECHA QUALQUER MODAL ABERTO
  show("statusBox");

if (status === "trial") {
$("statusText").innerText = "Teste gr√°tis ativo";
$("statusSub").innerText = fim ? ("V√°lido at√©: " + fim.toLocaleString()) : "";
} else {
$("statusText").innerText = "Acesso Premium ativo";
$("statusSub").innerText = fim ? ("V√°lido at√©: " + fim.toLocaleString()) : "";
}
return;
}

$("qrBox").classList.add("hide");
$("payMsg").innerText = "";
$("qrSub").innerText = "";

abrirModal(
  "aviso",
  "Acesso expirado",
  "Seu per√≠odo de teste terminou. Voc√™ pode sair e entrar com outra conta ou escolher um plano."
);

// s√≥ mostra o paywall, sem bloquear a troca de conta
show("payBox");

} // ‚Üê FECHA carregarStatus()

/* ===== PIX ===== */
let pollingTimer = null;

async function gerarPix(plan){
try{
const user = auth.currentUser;
if(!user){ show("loginBox"); setMsg("Fa√ßa login."); return; }

$("qrBox").classList.add("hide");
$("payMsg").innerText = "";
$("qrSub").innerText = "Gerando cobran√ßa PIX...";

const resp = await createPixChargeCall({ plan });
const data = resp.data;

if(data.alreadyEntitled){
$("qrSub").innerText = "Seu acesso j√° est√° ativo. Abrindo o app...";
setTimeout(()=>location.href = FRONT_URL, 700);
return;
}

$("qrBox").classList.remove("hide");
$("qrSub").innerText = `Plano: ${plan} ‚Äî Valor: R$ ${String(data.price).replace(".", ",")}`;

$("qrImg").src = "data:image/png;base64," + data.qrcodeImage;
$("pixCopia").value = data.copiaecola;

$("payMsg").innerText = "Aguardando pagamento... (deixe esta tela aberta)";

if(pollingTimer) clearInterval(pollingTimer);
pollingTimer = setInterval(()=> checarPagamento(data.txid), 5000);

await checarPagamento(data.txid);

}catch(e){
console.error("ERRO createPixCharge:", e);
const msg = e?.details || e?.message || "Erro ao gerar PIX";
$("payMsg").innerText = msg;
}
}

async function checarPagamento(txid){
try{
const user = auth.currentUser;
if(!user) return;

const resp = await pixStatusCall({ txid });
const data = resp.data;

if (data.paid) {
if(pollingTimer) clearInterval(pollingTimer);
$("payMsg").innerHTML = "<span class='ok'>Pagamento confirmado. Liberando acesso...</span>";
setTimeout(()=> location.href = FRONT_URL, 900);
return;
}

$("payMsg").innerText = "Aguardando pagamento... (atualiza automaticamente)";
}catch{
// mant√©m silencioso
}
}

async function recuperarSenha() {
  const email = $("email").value.trim();

  if (!email) {
    abrirModal(
      "aviso",
      "E-mail obrigat√≥rio",
      "Digite seu e-mail para enviarmos o link de redefini√ß√£o de senha."
    );
    return;
  }

  try {
    await sendPasswordResetEmail(auth, email);

    abrirModal(
      "sucesso",
      "E-mail enviado",
      "Se este e-mail estiver cadastrado, voc√™ receber√° um link para redefinir sua senha."
    );
  } catch (e) {
    console.error(e);

    abrirModal(
      "erro",
      "Erro ao enviar e-mail",
      "N√£o foi poss√≠vel enviar o e-mail. Verifique o endere√ßo informado."
    );
  }
}

/* ===== START ===== */
// estado inicial SEMPRE √© login
show("loginBox");

</script>
     
</body>
</html>














