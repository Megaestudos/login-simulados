<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Simulados de Concursos</title>

<style>
:root{
--primary:#2563eb;
--primary-dark:#1e40af;
--card:#ffffff;
--text:#0f172a;
--border:#e2e8f0;
--success:#16a34a;
}
*{box-sizing:border-box}
body{
margin:0;
font-family:Inter,system-ui,-apple-system,Arial,sans-serif;
min-height:100vh;
color:#fff;
background:
linear-gradient(rgba(15,23,42,.7),rgba(15,23,42,.7)),
url("https://images.pexels.com/photos/990432/pexels-photo-990432.jpeg");
background-size:cover;
background-position:center;
background-attachment:fixed;
}
.page{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
.container{width:100%;max-width:980px;display:grid;grid-template-columns:1.2fr 1fr;gap:40px}
@media(max-width:900px){.container{grid-template-columns:1fr}}

.card{
background:#fff;color:#0f172a;border-radius:20px;
padding:32px;box-shadow:0 40px 80px rgba(0,0,0,.35)
}
input,button{
width:100%;padding:14px;border-radius:12px;font-size:15px
}
input{border:1px solid var(--border);margin:6px 0 16px}
button{border:0;cursor:pointer}
.btn-primary{background:var(--primary);color:#fff}
.btn-primary:hover{background:var(--primary-dark)}
.btn-sec{background:#f1f5f9;margin-top:10px}
.msg{margin-top:14px;font-size:14px;text-align:center;color:#dc2626}
.hide{display:none}
.hr{height:1px;background:#e2e8f0;margin:18px 0}
.small{font-size:13px;color:#64748b}

.plan{border:1px solid #e2e8f0;border-radius:14px;padding:14px;margin-top:10px}
.qrImg{width:100%;max-width:260px;border:1px solid #e2e8f0;border-radius:12px;padding:10px;background:#fff}
.copyRow{display:flex;gap:8px;margin-top:10px}
.copyRow input{margin:0;flex:1}
.copyRow button{width:auto;background:#0f172a;color:#fff}
.ok{color:#16a34a}
</style>
</head>

<body>
<div class="page">
<div class="container">

<div>
<h1>Prepare-se para concursos</h1>
<p>Teste grátis por 48 horas</p>
</div>

<div class="card">

<!-- LOGIN -->
<div id="loginBox">
<input id="email" type="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button class="btn-primary" id="btnEntrar">Entrar</button>
<button class="btn-sec" id="btnCriar">Criar conta gratuita</button>
<div id="msgLogin" class="msg"></div>
</div>

<!-- STATUS -->
<div id="statusBox" class="hide">
<div class="hr"></div>
<div id="statusText" style="font-weight:900"></div>
<div id="statusSub" class="small"></div>
<button class="btn-primary" id="btnAcessar">Acessar o App</button>
<button class="btn-sec" id="btnSair">Sair</button>
</div>

<!-- PAYWALL -->
<div id="payBox" class="hide">
<div class="hr"></div>
<div id="payMsg" class="small"></div>

<div class="plan">
<strong>Plano 6 meses – R$ 29,90</strong>
<button class="btn-primary" id="btnPlano6">Gerar PIX</button>
</div>

<div class="plan">
<strong>Plano 12 meses – R$ 49,90</strong>
<button class="btn-primary" id="btnPlano12">Gerar PIX</button>
</div>

<div id="qrBox" class="hide">
<div class="hr"></div>
<img id="qrImg" class="qrImg">
<div class="copyRow">
<input id="pixCopia" readonly>
<button id="btnCopiar">Copiar</button>
</div>
</div>
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import {
getAuth,
signInWithEmailAndPassword,
createUserWithEmailAndPassword,
sendEmailVerification,
signOut,
setPersistence,
browserSessionPersistence
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import {
getFunctions,
httpsCallable
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-functions.js";

/* CONFIG */
const FRONT_URL="https://megaestudos.github.io/Quiz-Guarda-Civil-Premium/";
const firebaseConfig={
apiKey:"AIzaSyB36ZszS8v_DeOn3at7zEo_tFq86WU0sI4",
authDomain:"simulados-concursos-22c91.firebaseapp.com",
projectId:"simulados-concursos-22c91"
};

/* INIT */
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
await setPersistence(auth,browserSessionPersistence);
const functions=getFunctions(app,"us-central1");

/* CALLABLES */
const me=httpsCallable(functions,"me");
const createPix=httpsCallable(functions,"createPixCharge");
const pixStatus=httpsCallable(functions,"pixStatus");

/* HELPERS */
const $=id=>document.getElementById(id);
function show(box){
["loginBox","statusBox","payBox"].forEach(b=>$(b).classList.add("hide"));
$(box).classList.remove("hide");
}
function msg(t){$("msgLogin").innerText=t||""}

/* EVENTS */
$("btnEntrar").onclick=entrar;
$("btnCriar").onclick=criarConta;
$("btnPlano6").onclick=()=>gerarPix("6m");
$("btnPlano12").onclick=()=>gerarPix("12m");
$("btnCopiar").onclick=()=>navigator.clipboard.writeText($("pixCopia").value);
$("btnAcessar").onclick=()=>location.href=FRONT_URL;
$("btnSair").onclick=async()=>{await signOut(auth);show("loginBox")};

/* LOGIN */
async function entrar(){
try{
msg("");
const email=$("email").value.trim();
const senha=$("senha").value;
if(!email||!senha) return msg("Preencha email e senha");

await signInWithEmailAndPassword(auth,email,senha);
const res=await me();

if(res.data.emailVerified===false){
msg("Confirme seu e-mail");
return;
}

if(!res.data.entitled){
show("payBox");
$("payMsg").innerText=res.data.expiresAt
?"Seu acesso expirou em "+new Date(res.data.expiresAt).toLocaleString()
:"Seu acesso expirou. Gere um PIX.";
return;
}

location.href=FRONT_URL;

}catch{
msg("Erro ao entrar");
}
}

/* CRIAR CONTA */
async function criarConta(){
try{
msg("");
const email=$("email").value.trim();
const senha=$("senha").value;
if(!email||!senha) return msg("Preencha email e senha");
const cred=await createUserWithEmailAndPassword(auth,email,senha);
await sendEmailVerification(cred.user);
await signOut(auth);
msg("Conta criada! Confirme o e-mail.");
}catch{
msg("Erro ao criar conta");
}
}

/* PIX */
let timer=null;
async function gerarPix(plan){
try{
$("qrBox").classList.add("hide");
$("payMsg").innerText="Gerando PIX...";
const res=await createPix({plan});

$("qrBox").classList.remove("hide");
$("qrImg").src="data:image/png;base64,"+res.data.qrcodeImage;
$("pixCopia").value=res.data.copiaecola;
$("payMsg").innerText="Aguardando pagamento...";

if(timer) clearInterval(timer);
timer=setInterval(()=>checar(res.data.txid),5000);

}catch{
$("payMsg").innerText="Erro ao gerar PIX";
}
}

async function checar(txid){
try{
const res=await pixStatus({txid});
if(res.data.paid){
clearInterval(timer);
$("payMsg").innerHTML="<span class='ok'>Pagamento confirmado!</span>";
setTimeout(()=>location.href=FRONT_URL,1000);
}
}catch{}
}

/* START */
show("loginBox");
</script>
</body>
</html>
